<?php
  
  include_once('simple_html_dom.php');
  //echo $urlMia;
  //$html = file_get_html($urlMia);
  $html = str_get_html('<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
</head>
<body><p>Dear Emanuele Zocca,</p>

<p>Please be informed that Tamara Rossignoli assigned you to Libretti Carisma task on 16-09-2013 11:48.</p>

<table width="705" border="0" cellspacing="0" cellpadding="0" bgcolor="#ffffff">
    <tr>
        <td width="368" valign="top">
            <table width="100%" border="0" cellspacing="0" cellpadding="0">
                <tr>
                    <td width="368" valign="top">
                        <table cellpadding="0" cellspacing="0" border="0" bgcolor="#ffffff" width="100%"
                               style="vertical-align:top;">
                            <tr>
                                <td height="20" bgcolor="#1c5b94" valign="middle" style="color:rgb(255,255,255);
                    font-size:12px;font-weight:bolder;padding-left:5px;text-align:left;font-family:Verdana,Arial,Helvetica,sans-serif;"
                                    colspan="2">
                                    Task Summary
                                </td>
                            </tr>
                            <tr>
                                <td height="17" bgcolor="#dce5ea" width="132" valign="top" style="color:rgb(0,0,0);
                    font-size:11px; padding-left:5px;text-align:left;font-weight:bold;font-family:Verdana,sans-serif;">
                                    Task name:
                                </td>
                                <td width="236" valign="top" bgcolor="#dce5ea" style="color:rgb(0,0,0);
                    font-size:11px;padding-left:1px;text-align:left;font-weight:normal;font-family:Verdana,sans-serif;">
                                    Libretti Carisma</td>
                            </tr>
                            <tr>
                                <td height="17" bgcolor="#dce5ea" width="132" valign="top" style="color:rgb(0,0,0);
                    font-size:11px; padding-left:5px;text-align:left;font-weight:bold;font-family:Verdana,sans-serif;">
                                    Task Number:
                                </td>
                                <td width="236" valign="top" bgcolor="#dce5ea" style="color:rgb(0,0,0);
                    font-size:11px;padding-left:1px;text-align:left;font-weight:normal;font-family:Verdana,sans-serif;">
                                    T0001</td>
                            </tr>
                            <tr>
                                <td height="17" bgcolor="#dce5ea" width="132" valign="top" style="color:rgb(0,0,0);
                    font-size:11px; padding-left:5px;text-align:left;font-weight:bold;font-family:Verdana,sans-serif;">
                                    Description:
                                </td>
                                <td width="236" valign="top" bgcolor="#dce5ea" style="color:rgb(0,0,0);
                    font-size:11px;padding-left:1px;text-align:left;font-weight:normal;font-family:Verdana,sans-serif;">
                                    100 libretti 
composti da 16 pag + copertina
 (4 quartini + copertina)
 f.to chiuso 23,5x30,5 cm 
f.to aperto 47x30,5 cm
 stampato a 4/4 colori
 interni su carta da 135 gr 
copertina su carta da 200 gr 
confezionato a punto metallico </td>
                            </tr>
                            <tr>
                                <td height="17" bgcolor="#dce5ea" width="132" valign="top" style="color:rgb(0,0,0);
                    font-size:11px; padding-left:5px;text-align:left;font-weight:bold;font-family:Verdana,sans-serif;">
                                    Priority:
                                </td>
                                <td width="236" valign="top" bgcolor="#dce5ea" style="color:rgb(0,0,0);
                    font-size:11px;padding-left:1px;text-align:left;font-weight:normal;font-family:Verdana,sans-serif;">
                                    Medium</td>
                            </tr>
                            <tr>
                                <td height="17" bgcolor="#dce5ea" width="132" valign="top" style="color:rgb(0,0,0);
                    font-size:11px; padding-left:5px;text-align:left;font-weight:bold;font-family:Verdana,sans-serif;">
                                    Status:
                                </td>
                                <td width="236" valign="top" bgcolor="#dce5ea" style="color:rgb(0,0,0);
                    font-size:11px;padding-left:1px;text-align:left;font-weight:normal;font-family:Verdana,sans-serif;">
                                    Not Started</td>
                            </tr>
                            <tr>
                                <td height="17" bgcolor="#dce5ea" width="132" valign="top" style="color:rgb(0,0,0);
                    font-size:11px; padding-left:5px;text-align:left;font-weight:bold;font-family:Verdana,sans-serif;">
                                    % completed:
                                </td>
                                <td width="236" valign="top" bgcolor="#dce5ea" style="color:rgb(0,0,0);
                    font-size:11px;padding-left:1px;text-align:left;font-weight:normal;font-family:Verdana,sans-serif;">
                                     0%</td>
                            </tr>
                        </table>
                    </td>
                </tr>
                                    <tr><td height="19" bgcolor="#ffffff" valign="top" colspan="2">&nbsp;</td></tr>
                    <tr>
                        <td width="368" valign="top">
                            <table cellpadding="0" cellspacing="0" border="0" bgcolor="#ffffff" width="100%"
                                   style="vertical-align:top;">
                                <tr>
                                    <td height="20" bgcolor="#1c5b94" valign="middle" style="color:rgb(255,255,255);
                    font-size:12px;font-weight:bolder;padding-left:5px;text-align:left;font-family:Verdana,Arial,Helvetica,sans-serif;"
                                        colspan="2">
                                        Additional Information
                                    </td>
                                </tr>
                                                                    <tr>
                                        <td height="17" bgcolor="#dce5ea" width="132" valign="top" style="color:rgb(0,0,0);
                    font-size:11px; padding-left:5px;text-align:left;font-weight:bold;font-family:Verdana,sans-serif;">
                                            Quantity:
                                        </td>
                                        <td width="236" valign="top" bgcolor="#dce5ea" style="color:rgb(0,0,0);
                    font-size:11px;padding-left:1px;text-align:left;font-weight:normal;font-family:Verdana,sans-serif;">
                                            
                                        </td>
                                    </tr>
                                                                    <tr>
                                        <td height="17" bgcolor="#dce5ea" width="132" valign="top" style="color:rgb(0,0,0);
                    font-size:11px; padding-left:5px;text-align:left;font-weight:bold;font-family:Verdana,sans-serif;">
                                            Proofs:
                                        </td>
                                        <td width="236" valign="top" bgcolor="#dce5ea" style="color:rgb(0,0,0);
                    font-size:11px;padding-left:1px;text-align:left;font-weight:normal;font-family:Verdana,sans-serif;">
                                            
                                        </td>
                                    </tr>
                                                                    <tr>
                                        <td height="17" bgcolor="#dce5ea" width="132" valign="top" style="color:rgb(0,0,0);
                    font-size:11px; padding-left:5px;text-align:left;font-weight:bold;font-family:Verdana,sans-serif;">
                                            Proof Date:
                                        </td>
                                        <td width="236" valign="top" bgcolor="#dce5ea" style="color:rgb(0,0,0);
                    font-size:11px;padding-left:1px;text-align:left;font-weight:normal;font-family:Verdana,sans-serif;">
                                            
                                        </td>
                                    </tr>
                                                                    <tr>
                                        <td height="17" bgcolor="#dce5ea" width="132" valign="top" style="color:rgb(0,0,0);
                    font-size:11px; padding-left:5px;text-align:left;font-weight:bold;font-family:Verdana,sans-serif;">
                                            Delivery Date:
                                        </td>
                                        <td width="236" valign="top" bgcolor="#dce5ea" style="color:rgb(0,0,0);
                    font-size:11px;padding-left:1px;text-align:left;font-weight:normal;font-family:Verdana,sans-serif;">
                                            
                                        </td>
                                    </tr>
                                                                    <tr>
                                        <td height="17" bgcolor="#dce5ea" width="132" valign="top" style="color:rgb(0,0,0);
                    font-size:11px; padding-left:5px;text-align:left;font-weight:bold;font-family:Verdana,sans-serif;">
                                            Activity:
                                        </td>
                                        <td width="236" valign="top" bgcolor="#dce5ea" style="color:rgb(0,0,0);
                    font-size:11px;padding-left:1px;text-align:left;font-weight:normal;font-family:Verdana,sans-serif;">
                                            
                                        </td>
                                    </tr>
                                                                    <tr>
                                        <td height="17" bgcolor="#dce5ea" width="132" valign="top" style="color:rgb(0,0,0);
                    font-size:11px; padding-left:5px;text-align:left;font-weight:bold;font-family:Verdana,sans-serif;">
                                            Section:
                                        </td>
                                        <td width="236" valign="top" bgcolor="#dce5ea" style="color:rgb(0,0,0);
                    font-size:11px;padding-left:1px;text-align:left;font-weight:normal;font-family:Verdana,sans-serif;">
                                            
                                        </td>
                                    </tr>
                                                                    <tr>
                                        <td height="17" bgcolor="#dce5ea" width="132" valign="top" style="color:rgb(0,0,0);
                    font-size:11px; padding-left:5px;text-align:left;font-weight:bold;font-family:Verdana,sans-serif;">
                                            1C:
                                        </td>
                                        <td width="236" valign="top" bgcolor="#dce5ea" style="color:rgb(0,0,0);
                    font-size:11px;padding-left:1px;text-align:left;font-weight:normal;font-family:Verdana,sans-serif;">
                                            
                                        </td>
                                    </tr>
                                                                    <tr>
                                        <td height="17" bgcolor="#dce5ea" width="132" valign="top" style="color:rgb(0,0,0);
                    font-size:11px; padding-left:5px;text-align:left;font-weight:bold;font-family:Verdana,sans-serif;">
                                            2P:
                                        </td>
                                        <td width="236" valign="top" bgcolor="#dce5ea" style="color:rgb(0,0,0);
                    font-size:11px;padding-left:1px;text-align:left;font-weight:normal;font-family:Verdana,sans-serif;">
                                            
                                        </td>
                                    </tr>
                                                                    <tr>
                                        <td height="17" bgcolor="#dce5ea" width="132" valign="top" style="color:rgb(0,0,0);
                    font-size:11px; padding-left:5px;text-align:left;font-weight:bold;font-family:Verdana,sans-serif;">
                                            2C:
                                        </td>
                                        <td width="236" valign="top" bgcolor="#dce5ea" style="color:rgb(0,0,0);
                    font-size:11px;padding-left:1px;text-align:left;font-weight:normal;font-family:Verdana,sans-serif;">
                                            
                                        </td>
                                    </tr>
                                                                    <tr>
                                        <td height="17" bgcolor="#dce5ea" width="132" valign="top" style="color:rgb(0,0,0);
                    font-size:11px; padding-left:5px;text-align:left;font-weight:bold;font-family:Verdana,sans-serif;">
                                            3P:
                                        </td>
                                        <td width="236" valign="top" bgcolor="#dce5ea" style="color:rgb(0,0,0);
                    font-size:11px;padding-left:1px;text-align:left;font-weight:normal;font-family:Verdana,sans-serif;">
                                            
                                        </td>
                                    </tr>
                                                                    <tr>
                                        <td height="17" bgcolor="#dce5ea" width="132" valign="top" style="color:rgb(0,0,0);
                    font-size:11px; padding-left:5px;text-align:left;font-weight:bold;font-family:Verdana,sans-serif;">
                                            3C:
                                        </td>
                                        <td width="236" valign="top" bgcolor="#dce5ea" style="color:rgb(0,0,0);
                    font-size:11px;padding-left:1px;text-align:left;font-weight:normal;font-family:Verdana,sans-serif;">
                                            
                                        </td>
                                    </tr>
                                                            </table>
                        </td>
                    </tr>
                            </table>
        </td>
        <td width="9">&nbsp;</td>
        <td width="328" valign="top">
            <table width="100%" border="0" cellspacing="0" cellpadding="0">
                <tr>
                    <td height="70" width="328" valign="top">
                        <table cellpadding="0" cellspacing="0" border="0" bgcolor="#ffffff" width="100%">
                            <tr>
                                <td height="20" bgcolor="#1c5b94" valign="middle" style="color:rgb(255,255,255);
                    font-size:12px;font-weight:bolder;padding-left:5px;text-align:left;font-family:Verdana,Arial,Helvetica,sans-serif;"
                                    colspan="2">
                                    Additional Details
                                </td>
                            </tr>
                            <tr>
                                <td height="17" bgcolor="#dce5ea" width="117" valign="top" style="color:rgb(0,0,0);
                    font-size:11px; padding-left:5px;text-align:left;font-weight:bold;font-family:Verdana,sans-serif;">
                                    Creator:
                                </td>
                                <td width="211" valign="top" bgcolor="#dce5ea" style="color:rgb(0,0,0);
                    font-size:11px;padding-left:1px;text-align:left;font-weight:normal;font-family:Verdana,sans-serif;">
                                    Tamara Rossignoli</td>
                            </tr>
                            <tr>
                                <td height="17" bgcolor="#dce5ea" width="117" valign="top" style="color:rgb(0,0,0);
                    font-size:11px; padding-left:5px;text-align:left;font-weight:bold;font-family:Verdana,sans-serif;">
                                    Project:
                                </td>
                                <td width="211" valign="top" bgcolor="#dce5ea" style="color:rgb(0,0,0);
                    font-size:11px;padding-left:1px;text-align:left;font-weight:normal;font-family:Verdana,sans-serif;">
                                    P2647_Abc_Libretto Carisma</td>
                            </tr>
                            <tr>
                                <td height="17" bgcolor="#dce5ea" width="117" valign="top" style="color:rgb(0,0,0);
                    font-size:11px; padding-left:5px;text-align:left;font-weight:bold;font-family:Verdana,sans-serif;">
                                    Client:
                                </td>
                                <td width="211" valign="top" bgcolor="#dce5ea" style="color:rgb(0,0,0);
                    font-size:11px;padding-left:1px;text-align:left;font-weight:normal;font-family:Verdana,sans-serif;">
                                    ABC Studi s.r.l.</td>
                            </tr>
                            <tr>
                                <td height="17" bgcolor="#dce5ea" width="117" valign="top" style="color:rgb(0,0,0);
                    font-size:11px; padding-left:5px;text-align:left;font-weight:bold;font-family:Verdana,sans-serif;">
                                    Assignee(s):
                                </td>
                                <td width="211" valign="top" bgcolor="#dce5ea" style="color:rgb(0,0,0);
                    font-size:11px;padding-left:1px;text-align:left;font-weight:normal;font-family:Verdana,sans-serif;">
                                    Andrea Andreoli,Emanuele Zocca</td>
                            </tr>
                            <tr>
                                <td height="9"></td>
                            </tr>
                        </table>
                    </td>
                </tr>
                <tr>
                    <td height="89" width="328" valign="top">
                        <table cellpadding="0" cellspacing="0" border="0" bgcolor="#ffffff" width="100%">
                            <td height="19" bgcolor="#ffffff" valign="top" colspan="2">&nbsp;</td>
                            <tr>
                                <td height="20" bgcolor="#1c5b94" valign="middle" style="color:rgb(255,255,255);
                    font-size:12px;font-weight:bolder;padding-left:5px;text-align:left;font-family:Verdana,Arial,Helvetica,sans-serif;"
                                    colspan="2">
                                    Dates
                                </td>
                            </tr>
                            <tr>
                                <td height="17" bgcolor="#dce5ea" width="117" valign="top" style="color:rgb(0,0,0);
                    font-size:11px; padding-left:5px;text-align:left;font-weight:bold;font-family:Verdana,sans-serif;">
                                    Start Date:
                                </td>
                                <td width="211" valign="top" bgcolor="#dce5ea" style="color:rgb(0,0,0);
                    font-size:11px;padding-left:1px;text-align:left;font-weight:normal;font-family:Verdana,sans-serif;">
                                    16-09-2013</td>
                            </tr>
                            <tr>
                                <td height="17" bgcolor="#dce5ea" width="117" valign="top" style="color:rgb(0,0,0);
                    font-size:11px; padding-left:5px;text-align:left;font-weight:bold;font-family:Verdana,sans-serif;">
                                    Due Date:
                                </td>
                                <td width="211" valign="top" bgcolor="#dce5ea" style="color:rgb(0,0,0);
                    font-size:11px;padding-left:1px;text-align:left;font-weight:normal;font-family:Verdana,sans-serif;">
                                    19-09-2013</td>
                            </tr>
                            <tr>
                                <td height="17" bgcolor="#dce5ea" width="117" valign="top" style="color:rgb(0,0,0);
                    font-size:11px; padding-left:5px;text-align:left;font-weight:bold;font-family:Verdana,sans-serif;">
                                    Est. Time:
                                </td>
                                <td width="211" valign="top" bgcolor="#dce5ea" style="color:rgb(0,0,0);
                    font-size:11px;padding-left:1px;text-align:left;font-weight:normal;font-family:Verdana,sans-serif;">
                                    00:00</td>
                            </tr>
                            <tr>
                                <td height="9"></td>
                            </tr>
                        </table>
                    </td>
                </tr>
            </table>
        </td>
    </tr>
</table>

<p>Click <a href="https://app.kpi.com/ProjectManagement.html?link=7SwPCR0hIuv85%252F0l5AMmKA%253D%253D&uid=rcC4eOL%2FMOU%3D&cid=yNUkdj2uBOA%3D" title="View task">here</a> to view the task</p>

<p>* If you are not able to click on the link, you can instead copy and paste the following address in to your web
    browser: </p>

<p><span style="color: #0033FF">https://app.kpi.com/ProjectManagement.html?link=7SwPCR0hIuv85%252F0l5AMmKA%253D%253D&uid=rcC4eOL%2FMOU%3D&cid=yNUkdj2uBOA%3D</span></p>
</body>
</html>');
function cleanString($str) { return strtolower(preg_replace('/\s+/', "_", trim($str))); } 
$chiaviArray = array('task_summary', 'additional_details', 'dates');

$result = array();
foreach($html->find('td') as $td) {
  $intestazione = cleanString($td->plaintext);
  if (in_array($intestazione, $chiaviArray)) {
    $temp_result = array();
    $table = $td->parent()->parent()->parent();
    $count = 0;
    $result_values = array();
    foreach ($table->find('tr') as $riga) {
      if ($count > 0) { // salto la prima riga
        $td_key = cleanString($riga->getElementsByTagName("td", 0)->plaintext);
        $td_val = cleanString($riga->getElementsByTagName("td", 1)->plaintext);
        if ($td_key != "") $temp_result[$td_key] = $td_val;
      }
      $count++;
    }
    $result[$intestazione] = $temp_result;
  }
} 

foreach ($result as $valori) {
  echo 'START<br/><br/>';
  echo '<ul>';
  foreach ($valori as $key => $value) {
    printf("<li>%s --> %s</li>", $key, $value);
  }
  echo '</ul>';
}